<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Bird Flu</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
</head>
<script src="http://d3js.org/d3.v3.min.js"></script>

<body>
    <h1>South Dakota example</h1>
    <style>
        .chart rect {
            fill: steelblue;
        }
        
        .chart text {
            fill: black;
            font: 10px sans-serif;
            text-anchor: middle;
        }
    </style>
    <svg class="chart"></svg>
    <script type="text/javascript">
        var SoDak = [
            {
                county: 'Moody',
                flockSize: 694700
      },
            {
                county: 'Yankton',
                flockSize: 70600
      },
            {
                county: "Hutchinson",
                flockSize: 70600
      },
            {
                county: "Spink",
                flockSize: 33300
      },
            {
                county: "Roberts",
                flockSize: 66600
      },
            {
                county: "McPherson",
                flockSize: 55200
      },
            {
                county: "McCook",
                flockSize: 54700
      },
            {
                county: "Kingsbury",
                flockSize: 71900
      },
            {
                county: "Beadle",
                flockSize: 50600
      }
].sort(function (obj1, obj2) {
            // Ascending: first flock less than the previous
            return obj1.flockSize - obj2.flockSize;
        });
        var margin = {
                top: 20,
                right: 30,
                bottom: 30,
                left: 80,
            },
            width = 960 - margin.left - margin.right,
            height = 1000 - margin.top - margin.bottom,
            barWidth = width / SoDak.length;
        //change attributes of chart
        var chart = d3.select(".chart")
            .attr({
                //preserveAspectRatio: "xMinYMin slice",
                //viewBox: "0 0" + " " + 960 + " " + 1000,
                width: width + margin.left + margin.right,
                height: height + margin.top + margin.bottom
            })
            .append("g")
            .attr({
                transform: "translate(" + margin.left + "," + margin.top + ")"
            });
        //make rectangles
        var yScale = d3.scale.linear()
            .domain([0, d3.max(SoDak, function (d) {
                console.log(d.flockSize);
                return d.flockSize;
            })])
            .range([0, height]);
        var xScale = d3.scale.ordinal()
            .domain(SoDak.map(function (d) {
                return d.county;
            }))
            .rangeRoundBands([0, width], 0.2);
        var yAxis = d3.svg.axis()
            .scale(yScale)
            .orient("left");
        var xAxis = d3.svg.axis()
            .scale(xScale)
            .orient("bottom");

        var bar = chart.selectAll("g")
            .data(SoDak)
            .enter().append("g");
        //add rectangles
        bar.append("rect")
            .attr({
                class: "flockSize",
                y: function (d) {
                    return height - yScale(d.flockSize);
                },
                x: function (d, i) {
                    return xScale(i);
                },
                width: xScale.rangeBand(),
                height: function (d) {
                    return yScale(d.flockSize);
                },
                fill: "#FF514B",
                transform: function (d) {
                    return "translate(" + xScale(d.county) + ",0)";
                },
            })
            //size labels
        var yLine = chart.append('g')
            .call(yAxis)
            .attr({
                class: "axis yAxis"
            })
            .selectAll("text")
            .style("text-anchor", "end")
            .attr({
                dx: "-.8em",
                dy: ".25em"
            })
            .append("text") //not appearing
            .attr({
                class: "yTitle",
                x: width / 2,
                y: margin.bottom - 5
            });
        var xLine = chart.append("g")
            .call(xAxis)
            .attr({
                class: "axis yAxis",
                transform: "translate(0," + height + ")"
            })
            .append("text")
            .attr({
                x: width / 2,
                y: margin.bottom - 5
            });

        function type(d) {
            d.flockSize = +d.flockSize;
            return d;
        }
    </script>
    <div>
        <iframe src="http://cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1dj3houOLjmuMDmRgIfGz5NNIcCzBZkXYDBkrLo7QZfo&font=Playfair&lang=en&initial_zoom=2&height=650" width="100%" height="650" frameborder="0"></iframe>
    </div>
</body>

</html>